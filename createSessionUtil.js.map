{"version":3,"file":"createSessionUtil.js","names":["CreateSessionUtil","startChatWootClient","client","config","chatWoot","_chatWootClient","chatWootClient","session","createSessionUtil","req","clientsArray","res","getClient","status","body","tokenStore","Factory","myTokenStore","createTokenStory","getToken","serverOptions","customUserDataDir","createOptions","puppeteerOptions","userDataDir","wppClient","create","Object","assign","deviceName","poweredBy","catchQR","base64Qr","asciiQR","attempt","urlCode","exportQR","onLoadingScreen","percent","message","logger","info","statusFind","eventEmitter","emit","qrcode","close","undefined","callWebHook","error","start","webhook","onParticipantsChanged","onReactionMessage","onRevokedMessage","onPollResponse","e","opendata","qrCode","urlcode","replace","imageBuffer","Buffer","from","io","data","toString","_headerSent","json","isConnected","startHelper","checkStateSession","listenMessages","listenAcks","onPresenceChanged","onStateChange","state","conflits","SocketState","CONFLICT","includes","useHere","onMessage","fs","writeFile","chatId","JSON","stringify","err","console","log","url","options","request","response","type","onLiveLocation","sender","id","location","onAnyMessage","download","onIncomingCall","call","onAck","ack","presenceChangedEvent","reaction","encodeFunction","decodeFunction","text","object","parse"],"sources":["../../src/util/createSessionUtil.js"],"sourcesContent":["/*\n * Copyright 2021 WPPConnect Team\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { clientsArray, eventEmitter } from './sessionUtil';\nimport { create, SocketState } from '@wppconnect-team/wppconnect';\nimport { callWebHook, startHelper } from './functions';\nimport { download } from '../controller/sessionController';\nimport Factory from './tokenStore/factory';\nimport chatWootClient from './chatWootClient';\nimport fs from 'fs';\nimport request from 'request';\n\nexport default class CreateSessionUtil {\n  startChatWootClient(client) {\n    if (client.config.chatWoot && !client._chatWootClient)\n      client._chatWootClient = new chatWootClient(client.config.chatWoot, client.session);\n    return client._chatWootClient;\n  }\n\n  async createSessionUtil(req, clientsArray, session, res) {\n    try {\n      let client = this.getClient(session);\n      if (client.status != null && client.status !== 'CLOSED') return;\n      client.status = 'INITIALIZING';\n      client.config = req.body;\n\n      const tokenStore = new Factory();\n      const myTokenStore = tokenStore.createTokenStory(client);\n\n      await myTokenStore.getToken(session);\n      this.startChatWootClient(client);\n\n      if (req.serverOptions.customUserDataDir) {\n        req.serverOptions.createOptions.puppeteerOptions = {\n          userDataDir: req.serverOptions.customUserDataDir + session,\n        };\n      }\n\n      let wppClient = await create(\n        Object.assign({}, { tokenStore: myTokenStore }, req.serverOptions.createOptions, {\n          session: session,\n          deviceName: req.serverOptions.deviceName,\n          poweredBy: req.serverOptions.poweredBy || 'WPPConnect-Server',\n          catchQR: (base64Qr, asciiQR, attempt, urlCode) => {\n            this.exportQR(req, base64Qr, urlCode, client, res);\n          },\n          onLoadingScreen: (percent, message) => {\n            req.logger.info(`[${session}] ${percent}% - ${message}`);\n          },\n          statusFind: (statusFind) => {\n            try {\n              eventEmitter.emit(`status-${client.session}`, client, statusFind);\n              if (statusFind === 'autocloseCalled' || statusFind === 'desconnectedMobile') {\n                client.status = 'CLOSED';\n                client.qrcode = null;\n                client.close();\n                clientsArray[session] = undefined;\n              }\n              callWebHook(client, req, 'status-find', { status: statusFind });\n              req.logger.info(statusFind + '\\n\\n');\n            } catch (error) {}\n          },\n        })\n      );\n\n      client = clientsArray[session] = Object.assign(wppClient, client);\n      await this.start(req, client);\n\n      if (req.serverOptions.webhook.onParticipantsChanged) {\n        await this.onParticipantsChanged(req, client);\n      }\n\n      if (req.serverOptions.webhook.onReactionMessage) {\n        await this.onReactionMessage(client, req);\n      }\n\n      if (req.serverOptions.webhook.onRevokedMessage) {\n        await this.onRevokedMessage(client, req);\n      }\n\n      if (req.serverOptions.webhook.onPollResponse) {\n        await this.onPollResponse(client, req);\n      }\n    } catch (e) {\n      req.logger.error(e);\n    }\n  }\n\n  async opendata(req, session, res) {\n    await this.createSessionUtil(req, clientsArray, session, res);\n  }\n\n  exportQR(req, qrCode, urlCode, client, res) {\n    eventEmitter.emit(`qrcode-${client.session}`, qrCode, urlCode, client);\n    Object.assign(client, {\n      status: 'QRCODE',\n      qrcode: qrCode,\n      urlcode: urlCode,\n    });\n\n    qrCode = qrCode.replace('data:image/png;base64,', '');\n    const imageBuffer = Buffer.from(qrCode, 'base64');\n\n    req.io.emit('qrCode', {\n      data: 'data:image/png;base64,' + imageBuffer.toString('base64'),\n      session: client.session,\n    });\n\n    callWebHook(client, req, 'qrcode', { qrcode: qrCode, urlcode: urlCode });\n    if (res && !res._headerSent) res.status(200).json({ status: 'qrcode', qrcode: qrCode, urlcode: urlCode });\n  }\n\n  async onParticipantsChanged(req, client) {\n    await client.isConnected();\n    await client.onParticipantsChanged((message) => {\n      callWebHook(client, req, 'onparticipantschanged', message);\n    });\n  }\n\n  async start(req, client) {\n    try {\n      await client.isConnected();\n      Object.assign(client, { status: 'CONNECTED', qrcode: null });\n\n      req.logger.info(`Started Session: ${client.session}`);\n      //callWebHook(client, req, 'session-logged', { status: 'CONNECTED'});\n      req.io.emit('session-logged', { status: true, session: client.session });\n      startHelper(client, req);\n    } catch (error) {\n      req.logger.error(error);\n      req.io.emit('session-error', client.session);\n    }\n\n    await this.checkStateSession(client, req);\n    await this.listenMessages(client, req);\n\n    if (req.serverOptions.webhook.listenAcks) {\n      await this.listenAcks(client, req);\n    }\n\n    if (req.serverOptions.webhook.onPresenceChanged) {\n      await this.onPresenceChanged(client, req);\n    }\n  }\n\n  async checkStateSession(client, req) {\n    await client.onStateChange((state) => {\n      req.logger.info(`State Change ${state}: ${client.session}`);\n      const conflits = [SocketState.CONFLICT];\n\n      if (conflits.includes(state)) {\n        client.useHere();\n      }\n    });\n  }\n\n  async listenMessages(client, req) {\n    await client.onMessage(async (message) => {\n      fs.writeFile('message.txt',`{body: ${message.body}, WaId: ${message.from}, AccountSid: ${message.chatId}, Message:${JSON.stringify(message)}`, (err) => {if (err) throw err;\n        console.log('Mensagem Salva,');});\n\n      var url = `https://enviae-bot.herokuapp.com/whatsapp/recivedmessages/${client.session}`\n      var options = {\n        'method': 'POST',\n        'url': url,\n        json: message\n      };\n      request(options, function (error, response) {\n        if (error) {\n          throw err;\n        } else {\n          fs.writeFile('messageret.txt', `{body: ${message.body}, mensagem enviada a API com sucesso}`, (err) => {\n            if (err) throw err;\n            console.log('Enviado API');\n          });\n        }\n      });\n      eventEmitter.emit(`mensagem-${client.session}`, client, message);\n      callWebHook(client, req, 'onmessage', message);\n      if (message.type === 'location')\n        client.onLiveLocation(message.sender.id, (location) => {\n          callWebHook(client, req, 'location', location);\n        });\n    });\n\n    await client.onAnyMessage((message) => {\n      message.session = client.session;\n\n      if (message.type === 'sticker') {\n        download(message, client, req.logger);\n      }\n\n      req.io.emit('received-message', { response: message });\n    });\n\n    await client.onIncomingCall(async (call) => {\n      req.io.emit('incomingcall', call);\n      callWebHook(client, req, 'incomingcall', call);\n    });\n  }\n\n  async listenAcks(client, req) {\n    await client.onAck(async (ack) => {\n      req.io.emit('onack', ack);\n      callWebHook(client, req, 'onack', ack);\n    });\n  }\n\n  async onPresenceChanged(client, req) {\n    await client.onPresenceChanged(async (presenceChangedEvent) => {\n      req.io.emit('onpresencechanged', presenceChangedEvent);\n      callWebHook(client, req, 'onpresencechanged', presenceChangedEvent);\n    });\n  }\n\n  async onReactionMessage(client, req) {\n    await client.isConnected();\n    await client.onReactionMessage(async (reaction) => {\n      req.io.emit('onreactionmessage', reaction);\n      callWebHook(client, req, 'onreactionmessage', reaction);\n    });\n  }\n\n  async onRevokedMessage(client, req) {\n    await client.isConnected();\n    await client.onRevokedMessage(async (response) => {\n      req.io.emit('onrevokedmessage', response);\n      callWebHook(client, req, 'onrevokedmessage', response);\n    });\n  }\n  async onPollResponse(client, req) {\n    await client.isConnected();\n    await client.onPollResponse(async (response) => {\n      req.io.emit('onpollresponse', response);\n      callWebHook(client, req, 'onpollresponse', response);\n    });\n  }\n\n  encodeFunction(data, webhook) {\n    data.webhook = webhook;\n    return JSON.stringify(data);\n  }\n\n  decodeFunction(text, client) {\n    let object = JSON.parse(text);\n    if (object.webhook && !client.webhook) client.webhook = object.webhook;\n    delete object.webhook;\n    return object;\n  }\n\n  getClient(session) {\n    let client = clientsArray[session];\n\n    if (!client) client = clientsArray[session] = { status: null, session: session };\n    return client;\n  }\n}\n"],"mappings":"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"}